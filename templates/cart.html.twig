{% extends 'base.html.twig' %}
{% block stylesheets %}
    <title>Cart</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="OneTech shop project">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
    <link href="plugins/fontawesome-free-5.0.1/css/fontawesome-all.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="styles/cart_styles.css">
    <link rel="stylesheet" type="text/css" href="styles/cart_responsive.css">
    <link rel="stylesheet" type="text/css" href="styles/main_styles.css">
    <link rel="stylesheet" type="text/css" href="/styles/product_styles.css">
    <link rel="stylesheet" type="text/css" href="/styles/product_responsive.css">
    <link href="https://fonts.googleapis.com/css?family=Orbitron&display=swap" rel="stylesheet">
{% endblock %}
{% block body %}
    <!-- Cart -->
    {% if products is defined %}
    <div class="cart_section">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 offset-lg-1">
                    <div class="cart_container">
                        <div class="cart_title">Корзина</div>
                        <div class="cart_items">
                            <ul class="cart_list">
                                {% for product in products %}
                                    <li class="cart_item clearfix">
                                        <div class="cart_item_image"><img src="/images/{{ product.image.get(0).imagePath }}" alt=""></div>
                                        <div class="cart_item_info d-flex flex-md-row flex-column justify-content-between">
                                            <div class="cart_item_name cart_info_col">
                                                <div class="cart_item_title">Название</div>
                                                <div class="cart_item_text"><a href="{{ path('product', {'slug': product.slug}) }}" target="_blank">{{ product.name }}</a></div>
                                            </div>
                                            <div class="cart_item_quantity cart_info_col">
                                                <div class="cart_item_title">Количество</div>
                                                <div class="product_quantity clearfix" style="margin-top: 20px; width: 120px">
                                                    <input id="quantity_input" type="text" value="{{ product.amount }}">
                                                    <div class="quantity_buttons">
                                                        <div id="quantity_inc_button" class="quantity_inc quantity_control"><i class="fas fa-chevron-up"></i></div>
                                                        <div id="quantity_dec_button" class="quantity_dec quantity_control"><i class="fas fa-chevron-down"></i></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="cart_item_price cart_info_col">
                                                <div class="cart_item_title">Цена</div>
                                                <div class="cart_item_text">
                                                    {% if product.ProductValue is not null%}
                                                        {% if product.MinimumWholesale is not null and  product.MinimumWholesale <= product.amount%}
                                                            {{ (product.WholesalePrice * product.ProductValue) }} UAH
                                                        {% else %}
                                                            {{ (product.retailPrice * product.ProductValue) }} UAH
                                                        {% endif %}
                                                    {% else %}
                                                        {% if product.MinimumWholesale is not null and  product.MinimumWholesale <= product.amount%}
                                                            {{ (product.WholesalePrice) }} UAH
                                                        {% else %}
                                                            {{ (product.retailPrice) }} UAH
                                                        {% endif %}
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="cart_item_total cart_info_col">
                                                <div class="cart_item_title">Итого</div>
                                                <div class="cart_item_text">
                                                    {% if product.ProductValue is not null%}
                                                        {% if product.MinimumWholesale is not null and  product.MinimumWholesale <= product.amount%}
                                                            {{ (product.WholesalePrice * product.ProductValue * product.amount) }} UAH
                                                        {% else %}
                                                            {{ (product.retailPrice * product.ProductValue * product.amount) }} UAH
                                                        {% endif %}
                                                    {% else %}
                                                        {% if product.MinimumWholesale is not null and  product.MinimumWholesale <= product.amount%}
                                                            {{ (product.WholesalePrice * product.amount) }} UAH
                                                        {% else %}
                                                            {{ (product.retailPrice * product.amount) }} UAH
                                                        {% endif %}
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>

                        <!-- Order Total -->
                        <div class="order_total">
                            <div class="order_total_content text-md-right">
                                <div class="order_total_title">Итого:</div>
                                <div class="order_total_amount"><span id="total">{{ total }}</span> UAH</div>
                            </div>
                        </div>

                        <div class="cart_buttons">
                            <a href="{{ path('checkout') }}">
                                <button type="button" class="button cart_button_checkout" id="checkout_button">Оформить заказ</button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        <div class="modal fade" id="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-dialog-centered" role="dialog">
                <div class="modal-content">
                    <div class="modal-header" style="border: unset">
{#                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">#}
{#                            <span aria-hidden="true">&times;</span>#}
{#                        </button>#}
                    </div>
                    <div class="modal-body text-center">
                        <h4>
                            Извините, но минимальная сумма заказа составляет {{ minOrder }}грн.
                        </h4>
                    </div>
                    <div class="modal-footer" style="border: unset">
                        <button type="button" class="btn-primary btn" data-dismiss="modal" aria-label="Close" style="font-size: 15px">Продолжить покупки</button>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="container">
            <h3>Габела, пустая корзина</h3>
            <a style="align-content: center" href="{{ path('index') }}">На главную</a>
        </div>
    {% endif %}
{% endblock %}
{% block javascripts %}
<script src="js/jquery-3.3.1.min.js"></script>
<script src="styles/bootstrap4/popper.js"></script>
<script src="styles/bootstrap4/bootstrap.min.js"></script>
<script src="plugins/greensock/TweenMax.min.js"></script>
<script src="plugins/greensock/TimelineMax.min.js"></script>
<script src="plugins/scrollmagic/ScrollMagic.min.js"></script>
<script src="plugins/greensock/animation.gsap.min.js"></script>
<script src="plugins/greensock/ScrollToPlugin.min.js"></script>
<script src="plugins/easing/easing.js"></script>
<script src="js/cart_custom.js"></script>
<script src="js/product_custom.js"></script>
<script src="js/main.js"></script>
    <script>
            document.getElementById('checkout_button').addEventListener('click', function(evt) {
                if ({{ minOrder }} > {{ total }}) {
                    evt.preventDefault();
                    $('#modal').modal('show');
                }
            }, false);
    </script>

{% endblock %}