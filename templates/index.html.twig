{% extends 'base.html.twig' %}
{% block body %}
    <div class="super_container">
        <!-- Banner -->
        <div class="banner">
            <div class="banner_background"></div>
            <div class="container banner_content">
                <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="row d-inline-flex height-300">
                                <div class="col-6">
                                    {% if first.sale is not null %}
                                    <div>
                                            <h2>Акция -{{ first.sale }}%</h2>
                                    </div>
                                    {% endif %}
                                    <div class="mt-lg-4 mt-sm-0 text-dark">
                                        <h4>
                                            <a class="text-dark text-break" href="{{ path('product', {'slug': first.slug}) }}">
                                                {% if first.name | length > 110 %}
                                                    {{ first.name | slice(0,110) }}...
                                                {% else %}
                                                    {{ first.name }}
                                                {% endif %}
                                            </a>
                                        </h4>
                                    </div>
                                    <div class="mt-lg-3 mt-md-3 mt-sm-1 d-inline-flex position-absolute bottom-15" style="width: max-content">
                                        {% if first.sale is not null %}
                                            {% if first.productValue is not null %}
                                                <p class="carousel_sale">{{ (first.productValue * first.retailPrice - (first.retailPrice * first.ProductValue/100 * first.sale))|round(1,'common') }} грн</p>
                                            {% else %}
                                                <p class="carousel_sale">{{ (first.retailPrice - (first.retailPrice /100 * first.sale))|round(1,'common') }} грн</p>
                                            {% endif %}

                                            {% if first.productValue is not null %}
                                                <s class="carousel_price">{{ (first.productValue * first.retailPrice)|round(1,'common') }} грн</s>
                                            {% else %}
                                                <s class="carousel_price">{{ first.retailPrice|round(1,'common') }} грн</s>
                                            {% endif %}
                                        {% else %}
                                            {% if first.productValue is not null %}
                                                <p class="carousel_sale">{{ (first.productValue * first.retailPrice - (first.retailPrice * first.ProductValue/100 * first.sale))|round(1,'common') }} грн</p>
                                            {% else %}
                                                <p class="carousel_sale">{{ (first.retailPrice - (first.retailPrice /100 * first.sale))|round(1,'common') }} грн</p>
                                            {% endif %}
                                        {% endif %}

                                    </div>
                                </div>
                                <div class="col-6 text-right">
                                    <img onerror="this.src = '/no-image.png'" style="mix-blend-mode: multiply;" src={% if first.image.get(0).ImagePath is defined %}
                     "/images/{{ first.image.get(0).ImagePath }}"
                                    {% else %}
                                        "/no-image.png"
                                    {% endif %}
                                    alt="/image/no-image.png">
                                </div>
                            </div>
                        </div>

                        {% for mainPage in mainPageProducts %}
                            <div class="carousel-item">
                                <div class="row d-inline-flex height-300">
                                    <div class="col-6 height-300">
                                        {% if mainPage.sale is not null %}
                                            <div>
                                                <h2>Акция -{{ mainPage.sale }}%</h2>
                                            </div>
                                        {% endif %}
                                        <div class="mt-lg-4 mt-sm-0 text-dark">
                                            <h4><a class="text-dark text-break" href="{{ path('product', {'slug': mainPage.slug}) }}">
                                                    {% if mainPage.name | length > 110 %}
                                                        {{ mainPage.name | slice(0,110) }}...
                                                    {% else %}
                                                        {{ mainPage.name }}
                                                    {% endif %}
                                                </a></h4>
                                        </div>
                                        <div class="mt-lg-3 mt-md-3 mt-sm-1 d-inline-flex position-absolute bottom-15" style="width: max-content">
                                            {% if mainPage.sale is not null %}
                                                {% if mainPage.productValue is not null %}
                                                    <p class="carousel_sale">{{ (mainPage.productValue * mainPage.retailPrice - (mainPage.retailPrice * mainPage.ProductValue/100 * mainPage.sale))|round(1,'common') }} грн</p>
                                                {% else %}
                                                    <p class="carousel_sale">{{ (mainPage.retailPrice - (mainPage.retailPrice /100 * mainPage.sale))|round(1,'common')}} грн</p>
                                                {% endif %}

                                                {% if mainPage.productValue is not null %}
                                                    <s class="carousel_price">{{ (mainPage.productValue * mainPage.retailPrice)|round(1,'common') }} грн</s>
                                                {% else %}
                                                    <s class="carousel_price">{{ mainPage.retailPrice|round(1,'common') }} грн</s>
                                                {% endif %}
                                            {% else %}
                                                {% if mainPage.productValue is not null %}
                                                    <p class="carousel_sale">{{ (mainPage.productValue * mainPage.retailPrice - (mainPage.retailPrice * mainPage.ProductValue/100 * mainPage.sale))|round(1,'common') }} грн</p>
                                                {% else %}
                                                    <p class="carousel_sale">{{ (mainPage.retailPrice - (mainPage.retailPrice /100 * mainPage.sale))|round(1,'common')}} грн</p>
                                                {% endif %}
                                            {% endif %}

                                        </div>
                                    </div>
                                    <div class="col-6 text-right">
                                        <img onerror="this.src = '/no-image.png'" src={% if mainPage.image.get(0).ImagePath is defined %}
                     "/images/{{ mainPage.image.get(0).ImagePath }}"
                                        {% else %}
                                            "/no-image.png"
                                        {% endif %}
                                        alt="/image/no-image.png">
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Characteristics -->
        <div class="characteristics">
            <div class="container">
                <div class="row">
                    <!-- Char. Item -->
                    <div class="col-lg-3 col-md-6 char_col">
                        <div class="char_item d-flex flex-row align-items-center justify-content-start">
                            <div class="char_icon"><i class="fas fa-truck fa-2x text-primary"></i></div>
                            <div class="char_content">
                                <div class="char_title">Быстрая доставка</div>
                                <div class="char_subtitle">Новой почтой</div>
                            </div>
                        </div>
                    </div>
                    <!-- Char. Item -->
                    <div class="col-lg-3 col-md-6 char_col">
                        <div class="char_item d-flex flex-row align-items-center justify-content-start">
                            <div class="char_icon"><i class="far fa-clock fa-2x text-primary"></i></div>
                            <div class="char_content">
                                <div class="char_title">24/7</div>
                                <div class="char_subtitle">Работаем круглочуточно</div>
                            </div>
                        </div>
                    </div>
                    <!-- Char. Item -->
                    <div class="col-lg-3 col-md-6 char_col">
                        <div class="char_item d-flex flex-row align-items-center justify-content-start">
                            <div class="char_icon"><i class="fas fa-2x fa-thumbs-up text-primary"></i></div>
                            <div class="char_content">
                                <div class="char_title">Надежность</div>
                                <div class="char_subtitle">Довольные покупатели</div>
                            </div>
                        </div>
                    </div>
                    <!-- Char. Item -->
                    <div class="col-lg-3 col-md-6 char_col">
                        <div class="char_item d-flex flex-row align-items-center justify-content-start">
                            <div class="char_icon"><i class="fas fa-percent fa-2x text-primary"></i></div>
                            <div class="char_content">
                                <div class="char_title">Акции</div>
                                <div class="char_subtitle">Постоянные скидки</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <!-- Best Sellers -->
        {% if specialProducts.0 is defined %}
        <div class="container" id="sale">
            <div class="col px-0 py-3 d-inline-block">
                <div class="viewed_title_container">
                    <div class="tabs clearfix tabs-right">
                        <div class="new_arrivals_title font-weight-bold">Хиты продаж<a id="view_all_resp" class="d-none float-right" href="#"></a></div>
                        <div class="mt-sm-1 mt-lg-4 mt-md-4"><span></span></div>
                    </div>
                </div>
            </div>
            <div class="scrolling-wrapper">
                {% for specialProduct in specialProducts %}
                    <a href="{{ path('product', {'slug': specialProduct.slug }) }}">
                        <div class="arrivals_slider_item card">
                            <div class="product_item is_new d-flex flex-column align-items-center justify-content-center text-center">
                                <div class="product_image d-flex flex-column align-items-center justify-content-center">
                                    <img src=
                                    {% if specialProduct.image.get(0).ImagePath is defined %}
                     "/images/{{ specialProduct.image.get(0).ImagePath }}"
                                    {% else %}
                                        "/no-image.png"
                                    {% endif %}
                                         alt="/image/no-image.png">
                                </div>
                                <div class="product_content">
                                    {% if specialProduct.ProductValue is not null %}
                                    <div class="product_price">
                                            {% if specialProduct.sale is not empty %}
                                                <div class="sale">
                                                    <s>{{ (specialProduct.retailPrice * specialProduct.ProductValue) | round(1,'common') }} грн</s><br>
                                                    {{ (specialProduct.retailPrice * specialProduct.ProductValue - (specialProduct.retailPrice * specialProduct.ProductValue/100 * specialProduct.sale)) | round(1,'common') }} грн
                                                </div>
                                            {% else %}
                                                <div class="price">
                                                    {{ (specialProduct.retailPrice * specialProduct.ProductValue) | round(1,'common') }} грн
                                                </div>
                                            {% endif %}
                                        </div>
                                        {% else %}
                                            <div class="product_price">
                                                {% if specialProduct.sale is not empty %}
                                                    <div class="sale">
                                                        <s>{{ (specialProduct.retailPrice) | round(1,'common') }} грн</s><br>
                                                        {{ (specialProduct.retailPrice - (specialProduct.retailPrice/100 * specialProduct.sale)) | round(1,'common') }} грн
                                                    </div>
                                                {% else %}
                                                    <div class="price">
                                                        {{ (specialProduct.retailPrice) | round(1,'common') }} грн
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                </div>
                                <div class="product_name">
                                    <p>
                                        {% if specialProduct.name | length > 52 %}
                                            {{ specialProduct.name | slice(0,52) }}...
                                        {% else %}
                                            {{ specialProduct.name }}
                                        {% endif %}
                                    </p>
                                </div>
                                <ul class="product_marks">
                                        {% if specialProduct.sale is not null %}
                                            <li class="product_mark product_discount">-{{ specialProduct.sale }}%</li>
                                        {% endif %}
                                            <li class="product_mark product_new"><i class="fas fa-thumbs-up"></i></li>
                                 </ul>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    <!-- Sale -->
        {% if saleProducts.0 is defined %}
        <div class="container py-3" id="popular">
        <div class="col px-0 d-inline-block py3">
            <div class="viewed_title_container">
                <div class="tabs clearfix tabs-right">
                    <div class="new_arrivals_title font-weight-bold">Акционные товары<a id="view_all_resp" class="d-none float-right" href="{{ path('sale_products') }}">Посмотреть все</a></div>
                    <ul class="clearfix" id="view_all">
                        <li class="active">
                            <a class="font-weight-bold h5 text-primary" href="{{ path('sale_products') }}">Посмотреть все</a>
                        </li>
                    </ul>
                    <div class="tabs_line"><span></span></div>
                </div>
            </div>
        </div>
        <div class="scrolling-wrapper">
            {% for specialProduct in saleProducts %}
                <a href="{{ path('product', {'slug': specialProduct.slug }) }}">
                    <div class="arrivals_slider_item card">
                        <div class="product_item is_new d-flex flex-column align-items-center justify-content-center text-center">
                            <div class="product_image d-flex flex-column align-items-center justify-content-center">
                                <img src=
                                {% if specialProduct.image.get(0).ImagePath is defined %}
                     "/images/{{ specialProduct.image.get(0).ImagePath }}"
                                {% else %}
                                    "/no-image.png"
                                {% endif %}

                            alt="/image/no-image.png">
                            </div>
                                <div class="product_content">
                                    <div class="product_price">
                                        {% if specialProduct.ProductValue is not null %}
                                            {% if specialProduct.sale is not empty %}
                                                <div class="sale">
                                                    <s>{{ (specialProduct.retailPrice * specialProduct.ProductValue) |round(1,'common') }} грн</s><br>
                                                    {{ (specialProduct.retailPrice * specialProduct.ProductValue - (specialProduct.retailPrice * specialProduct.ProductValue/100 * specialProduct.sale)) |round(1,'common') }} грн
                                                </div>
                                            {% else %}
                                                <div class="price">
                                                    {{ (specialProduct.retailPrice * specialProduct.ProductValue) |round(1,'common') }} грн
                                                </div>
                                            {% endif %}
                                    </div>
                                        {% else %}
                                            {% if specialProduct.sale is not empty %}
                                                <div class="sale">
                                                    <s>{{ (specialProduct.retailPrice) | round(1,'common') }} грн</s><br>
                                                    {{ (specialProduct.retailPrice - (specialProduct.retailPrice/100 * specialProduct.sale)) | round(1,'common') }} грн
                                                </div>
                                            {% else %}
                                                <div class="price">
                                                    {{ (specialProduct.retailPrice) | round(1,'common') }} грн
                                                </div>
                                            {% endif %}
                                    </div>
                                        {% endif %}
                                </div>
                    </div>
                            <div class="product_name">
                                <p>
                                    {% if specialProduct.name | length > 52 %}
                                        {{ specialProduct.name | slice(0,52) }}...
                                    {% else %}
                                        {{ specialProduct.name }}
                                    {% endif %}
                                </p>
                            </div>

                            <ul class="product_marks">
                                    <li class="product_mark product_discount">-{{ specialProduct.sale }}%</li>
                                {% if specialProduct.specialOffer == true %}
                                    <li class="product_mark product_new"><i class="fas fa-thumbs-up"></i></li>
                                {% endif %}
                            </ul>
                        </div>
                    </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).on('click', '.add_to_basket_main', function () {
            let element = $(this);
            $.ajax({
                method: "POST",
                url: '/add_to_basket',
                data: {
                    'slug': $(this).val(),
                }
            })
                .done(function() {
                    element.html('В корзине <i class="fas fa-check"></i>').css('background-color','green');
                    $('#basket-product-amount').html(Number($('#basket-product-amount').html()) + 1);
                });
        });
    </script>
{% endblock %}